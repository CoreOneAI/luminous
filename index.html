<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Luminous AI - Your Radiant Beauty Companion</title>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="theme-color" content="#B8860B"/>
  <link rel="manifest" href="manifest.json"/>
  <script>
    // Splash on first load only
    const splashShown = sessionStorage.getItem('splashShown');
    if (!splashShown) window.location.href = '/splash.html';
  </script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary-charcoal:#2C2C2C;
      --luminous-gold:#B8860B;
      --pearl-white:#F8F8F8;
      --premium-gradient:linear-gradient(135deg,#B8860B,#DAA520);
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
      background:var(--primary-charcoal);color:#333;min-height:100vh;overflow-x:hidden
    }
    .container{max-width:414px;margin:0 auto;background:var(--primary-charcoal);min-height:100vh;position:relative}
    .header{background:var(--primary-charcoal);padding:20px;text-align:center;border-bottom:1px solid #3A3A3A}
    .logo{font-size:28px;font-weight:700;margin-bottom:8px;
      background:var(--premium-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .tagline{font-size:14px;color:var(--luminous-gold);font-weight:500;opacity:.9}
    .main-content{background:var(--pearl-white);min-height:calc(100vh - 120px);padding:20px}

    .welcome-section{background:#fff;border-radius:16px;padding:24px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,.1);text-align:center}
    .welcome-title{font-size:20px;font-weight:700;color:#222;margin-bottom:8px}
    .welcome-subtitle{font-size:14px;color:#666;margin-bottom:16px}

    .ai-search-container{margin-bottom:12px}
    .ai-search-bar{background:#fff;border-radius:25px;padding:12px 14px;display:flex;align-items:center;gap:10px;
      box-shadow:0 4px 12px rgba(0,0,0,.08);border:2px solid var(--luminous-gold)}
    .ai-icon{font-size:18px;color:var(--luminous-gold)}
    .ai-input{flex:1;border:none;outline:none;font-size:14px;background:transparent;color:#222}
    .ai-input::placeholder{color:#999;font-style:italic}
    .ai-send-btn{background:var(--premium-gradient);border:none;border-radius:20px;width:40px;height:40px;display:flex;align-items:center;
      justify-content:center;color:#fff;cursor:pointer;transition:.2s}
    .ai-send-btn:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(184,134,11,.3)}
    .chat-btn{background:var(--premium-gradient);color:#fff;border:none;padding:14px 22px;border-radius:22px;font-weight:600;font-size:16px;
      cursor:pointer;width:100%;box-shadow:0 4px 12px rgba(184,134,11,.25);transition:.2s}
    .chat-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(184,134,11,.35)}

    .quick-actions{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:16px 0 20px}
    .action-card{background:#fff;border-radius:12px;padding:8px 6px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.1);
      transition:.2s;cursor:pointer;position:relative;min-height:60px;display:flex;flex-direction:column;justify-content:center}
    .action-card:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.15)}
    .premium-feature{background:linear-gradient(135deg,#FFF9E6,#FFFFFF);border:1px solid var(--luminous-gold)}
    .premium-star{position:absolute;top:3px;right:3px;font-size:8px;color:var(--luminous-gold)}
    .action-icon{width:28px;height:28px;border-radius:14px;background:var(--premium-gradient);display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;margin:0 auto 4px}
    .action-title{font-size:10px;font-weight:600;color:#222;margin-bottom:2px;line-height:1.1}
    .action-subtitle{font-size:8px;color:#666;line-height:1.1}

    /* Chat block */
    .chat-card{background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.1);padding:14px;margin-bottom:16px}
    .chat-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .chat-title{font-size:14px;font-weight:700;color:#222}
    .chat-status{font-size:11px;color:#888}
    .chat-thread{max-height:300px;overflow:auto;padding:6px;scroll-behavior:smooth}
    .bubble{display:inline-block;max-width:80%;padding:10px 12px;border-radius:14px;font-size:14px;line-height:1.35;margin:6px 0;
      box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .bubble.user{margin-left:auto;background:rgba(184,134,11,.12);border:1px solid rgba(184,134,11,.35)}
    .bubble.bot{margin-right:auto;background:#fff;border:1px solid #eee}
    .typing{display:inline-flex;gap:4px;align-items:center}
    .dot{width:6px;height:6px;background:#aaa;border-radius:50%;animation:blink 1.2s infinite ease-in-out}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.3}40%{opacity:1}}

    /* Products */
    .section-head{display:flex;align-items:center;justify-content:space-between;margin:6px 0 10px}
    .section-title{font-size:15px;font-weight:700;color:#222}
    .search-row{display:flex;gap:8px}
    .search-input{flex:1;border:1px solid #ddd;border-radius:10px;padding:8px 10px;font-size:14px;background:#fff}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:.6rem .9rem;border-radius:12px;font-weight:600;border:0}
    .btn-subtle{background:#f0f1f3;color:#222}
    .btn-accent{background:var(--premium-gradient);color:#fff}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .card{background:#fff;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,.06);overflow:hidden}
    .imgph{height:144px;background:#eee;display:flex;align-items:center;justify-content:center;color:#999;font-size:12px}
    .meta{padding:10px}
    .brand{font-size:11px;color:#6b7280}
    .name{font-size:15px;font-weight:600;line-height:1.2;margin-top:2px}
    .row{display:flex;align-items:center;justify-content:space-between;margin-top:6px}
    .price{font-size:15px;font-weight:700}
    .was{font-size:11px;color:#9ca3af;text-decoration:line-through}
    .btn-line{display:flex;gap:8px;margin-top:8px}
    .badge{font-size:10px;padding:2px 8px;background:#fde8b2;color:#8a6b11;border-radius:999px}

    .empty{text-align:center;font-size:13px;color:#666;margin:18px 0}
    .footer-gap{height:100px}

    /* Bottom nav (kept visible; no external page links) */
    .bottom-nav{background:#fff;height:80px;display:flex;align-items:center;justify-content:space-around;border-top:1px solid #E0E0E0;
      padding-bottom:20px;position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:414px}
    .nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;color:#666;cursor:pointer}
    .nav-item.active{color:var(--luminous-gold)}
    .nav-icon{width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:20px}
    .nav-label{font-size:10px;font-weight:500}

    @media(max-width:380px){
      .quick-actions{grid-template-columns:1fr 1fr;gap:12px}
      .action-card{min-height:80px;padding:12px 8px}
      .action-title{font-size:11px}
      .action-subtitle{font-size:9px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">‚ú® Luminous AI</div>
      <div class="tagline">Your Radiant Beauty Companion</div>
    </div>

    <div class="main-content">
      <!-- Welcome + Ask -->
      <div class="welcome-section">
        <div class="welcome-title">Welcome to Your Beauty Journey</div>
        <div class="welcome-subtitle">Get personalized AI-powered beauty recommendations from global experts</div>

        <div class="ai-search-container">
          <div class="ai-search-bar">
            <div class="ai-icon">ü§ñ</div>
            <input id="aiInput" class="ai-input" placeholder="Ask: ‚ÄòBest makeup for pale skin with cool undertones‚Äô"/>
            <button id="askBtn" class="ai-send-btn" title="Ask"><span>‚ú®</span></button>
          </div>
        </div>

        <button class="chat-btn" id="consultBtn">üåü Start Beauty Consultation</button>
      </div>

      <!-- Quick actions (click = chat in place + filter grid) -->
      <div class="quick-actions" id="quickGrid">
        <div class="action-card premium-feature"
             data-preset="Recommend an anti-aging routine for sensitive, dry skin. Focus on gentle actives and SPF."
             data-filter="anti-aging">
          <div class="premium-star">‚≠ê</div>
          <div class="action-icon">üßò</div>
          <div class="action-title">Anti-aging</div>
          <div class="action-subtitle">Wellness & skincare</div>
        </div>

        <div class="action-card"
             data-preset="Best eye care regimen to reduce puffiness and dark circles, fragrance-free."
             data-filter="eye care">
          <div class="action-icon">üëÅÔ∏è</div>
          <div class="action-title">Eye Care</div>
          <div class="action-subtitle">2,000+ eye products</div>
        </div>

        <div class="action-card premium-feature"
             data-preset="Give me a skin analysis checklist to share with my stylist before an appointment."
             data-filter="skin care">
          <div class="premium-star">‚≠ê</div>
          <div class="action-icon">‚ú®</div>
          <div class="action-title">Skin Analysis</div>
          <div class="action-subtitle">AI recommendations</div>
        </div>

        <div class="action-card premium-feature"
             data-preset="Suggest a facial plan for dullness and texture with gentle exfoliation."
             data-filter="facial">
          <div class="premium-star">‚≠ê</div>
          <div class="action-icon">üòä</div>
          <div class="action-title">Facial Analysis</div>
          <div class="action-subtitle">AI face scanning</div>
        </div>

        <div class="action-card"
             data-preset="Show current beauty trends and viral looks; add approachable options for everyday wear."
             data-filter="sale">
          <div class="action-icon">üè∑Ô∏è</div>
          <div class="action-title">Discounts</div>
          <div class="action-subtitle">discount products</div>
        </div>

        <div class="action-card"
             data-preset="Nail care routine for brittle nails plus polish shades for cool undertones."
             data-filter="nail">
          <div class="action-icon">üíÖ</div>
          <div class="action-title">Nail Care</div>
          <div class="action-subtitle">2,000+ nail products</div>
        </div>

        <div class="action-card"
             data-preset="Useful beauty tools and accessories for travel: compact, TSA-friendly."
             data-filter="accessories">
          <div class="action-icon">üíé</div>
          <div class="action-title">Accessories</div>
          <div class="action-subtitle">2,000+ beauty tools</div>
        </div>

        <div class="action-card" id="basketBtn">
          <div class="action-icon">üõí</div>
          <div class="action-title">Basket</div>
          <div class="action-subtitle">3 items ‚Ä¢ $127.50</div>
          <div class="badge">Demo</div>
        </div>
      </div>

      <!-- In-page Chat -->
      <div class="chat-card" id="chatCard" aria-live="polite">
        <div class="chat-head">
          <div class="chat-title">AI Suggestions</div>
          <div class="chat-status" id="chatStatus">Ready</div>
        </div>
        <div class="chat-thread" id="chatThread"></div>
      </div>

      <!-- Products -->
      <div class="section-head">
        <div class="section-title">Your Recommendations</div>
        <div class="search-row">
          <input id="searchBox" class="search-input" placeholder="Search products‚Ä¶"/>
          <button id="clearBtn" class="btn btn-subtle">Clear</button>
        </div>
      </div>

      <div id="results" class="grid"></div>
      <div id="emptyState" class="empty" style="display:none">
        <p class="font-medium">No products found</p>
        <p>Try a different search or be more specific about your needs.</p>
      </div>
      <div style="margin-top:10px;">
        <button id="loadMore" class="btn btn-subtle" style="width:100%;">Load more</button>
      </div>

      <div class="footer-gap"></div>
    </div>

    <!-- Bottom nav (no external page links) -->
    <div class="bottom-nav">
      <div class="nav-item active" data-nav="home"><div class="nav-icon">üè†</div><div class="nav-label">Home</div></div>
      <div class="nav-item" data-nav="signin"><div class="nav-icon">üîë</div><div class="nav-label">Sign In</div></div>
      <div class="nav-item" data-nav="create"><div class="nav-icon">üë§</div><div class="nav-label">Create Account</div></div>
      <div class="nav-item" data-nav="catalog"><div class="nav-icon">üåç</div><div class="nav-label">Catalog</div></div>
      <div class="nav-item" data-nav="ask"><div class="nav-icon">üí¨</div><div class="nav-label">Ask Me</div></div>
    </div>
  </div>

  <script>
    // ---------------- Config ----------------
    const CHAT_ENDPOINTS = ['/ask','/chat'];   // only routes you actually have
    const JSON_PRODUCTS  = '/products.json';   // single source for catalog

    // ---------------- Helpers ----------------
    const $ = (sel,root=document)=>root.querySelector(sel);
    const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
    const chatThread = $('#chatThread');
    const chatStatus = $('#chatStatus');

    function setStatus(s){ chatStatus.textContent = s; }
    function safe(s){ return (s ?? '').toString(); }

    function formatPrice(v){
      if (v===null||v===undefined||v==='') return '$‚Äî';
      if (typeof v==='number'){
        if (Number.isInteger(v) && v>=100) return '$'+(v/100).toFixed(2);
        return '$'+v.toFixed(2);
      }
      const s = String(v).trim();
      if (s.startsWith('$')) return s;
      const n = parseFloat(s);
      if (!isFinite(n)) return '$‚Äî';
      if (!s.includes('.') && n>=100) return '$'+(n/100).toFixed(2);
      return '$'+n.toFixed(2);
    }

    function addBubble(role, text, { typing=false }={}){
      const b = document.createElement('div');
      b.className = `bubble ${role}`;
      if (typing){
        b.innerHTML = `<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
      } else {
        b.textContent = text;
      }
      chatThread.appendChild(b);
      chatThread.scrollTop = chatThread.scrollHeight;
      return b;
    }

    async function typeText(el, text, speed=12){
      el.textContent = '';
      for (let i=0;i<text.length;i++){
        el.textContent += text[i];
        if (i%3===0) await new Promise(r=>setTimeout(r, speed));
        chatThread.scrollTop = chatThread.scrollHeight;
      }
    }

    async function askBackend(message){
      let err;
      for (const ep of CHAT_ENDPOINTS){
        try{
          const r = await fetch(ep,{
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body: JSON.stringify({ message, includeProducts:false })
          });
          if (!r.ok) throw new Error('HTTP '+r.status);
          const data = await r.json().catch(()=> ({}));
          return data.reply || data.response || data.text || 'Sorry, no answer available.';
        }catch(e){ err=e; }
      }
      throw err || new Error('All endpoints failed');
    }

    async function askInPlace(q){
      if (!q) return;
      setStatus('Thinking‚Ä¶');
      addBubble('user', q);
      const typing = addBubble('bot','',{typing:true});
      try{
        const reply = await askBackend(q);
        typing.innerHTML = '';
        await typeText(typing, reply, 10);
      }catch(e){
        typing.innerHTML='';
        await typeText(typing, '‚ö†Ô∏è Could not reach AI. Please try again.');
      }finally{
        setStatus('Ready');
      }
    }

    // ---------------- Products (JSON only) ----------------
    class Catalog {
      constructor(){
        this.results   = $('#results');
        this.empty     = $('#emptyState');
        this.searchBox = $('#searchBox');
        this.clearBtn  = $('#clearBtn');
        this.moreBtn   = $('#loadMore');

        this.all   = [];   // full catalog from JSON
        this.query = '';
        this.offset = 0;
        this.pageSize = 8;
        this.total = 0;

        this.bind();
        this.bootstrap();
      }

      bind(){
        this.searchBox.addEventListener('input', ()=>{
          this.query = this.searchBox.value.trim();
          this.offset=0; this.render(true);
        });
        this.clearBtn.addEventListener('click', ()=>{
          this.searchBox.value=''; this.query=''; this.offset=0; this.render(true);
        });
        this.moreBtn.addEventListener('click', ()=> this.render());
      }

      async bootstrap(){
        try{
          const r = await fetch(JSON_PRODUCTS+'?bust='+Date.now());
          if (r.ok) this.all = await r.json();
        }catch{}
        this.render(true);
      }

      filtered(){
        const q = this.query.toLowerCase();
        if (!q) return this.all.slice();
        return this.all.filter(p=>{
          const hay = [
            p.name,p.brand,p.category,p.description,p.usage,p.ingredients,p.suitableFor
          ].filter(Boolean).join(' ').toLowerCase();
          if (q==='sale'){
            const price = Number(p.price);
            const was   = Number(p.was);
            return (isFinite(price) && isFinite(was) && was > price) || hay.includes('sale') || hay.includes('discount');
          }
          return hay.includes(q);
        });
      }

      async render(reset=false){
        if (reset){
          this.results.innerHTML=''; this.offset=0; this.total=0;
        }

        // skeletons
        const sk = document.createElement('div');
        sk.className='grid';
        sk.innerHTML = Array.from({length:4}).map(()=>`
          <div class="card">
            <div class="imgph">Loading‚Ä¶</div>
            <div class="meta">
              <div class="brand"> </div>
              <div class="name"> </div>
              <div class="row"><div class="price"> </div><div class="was"> </div></div>
              <div class="btn-line"><div class="btn btn-subtle" style="flex:1"> </div><div class="btn btn-accent" style="flex:1"> </div></div>
            </div>
          </div>`).join('');
        this.results.appendChild(sk);

        try{
          const list = this.filtered();
          this.total = list.length;
          const items = list.slice(this.offset, this.offset + this.pageSize);
          this.offset += items.length;

          const frag = document.createDocumentFragment();
          for (const p of items) frag.appendChild(this.card(p));
          this.results.replaceChild(frag, sk);

          const hasAny = this.results.children.length>0;
          this.empty.style.display = hasAny ? 'none' : 'block';

          const hasMore = this.offset < this.total;
          this.moreBtn.disabled = !hasMore;
          this.moreBtn.textContent = hasMore ? 'Load more' : 'No more items';
        }catch(e){
          console.error('render error', e);
          this.results.removeChild(sk);
          this.empty.style.display='block';
          this.moreBtn.disabled = true;
          this.moreBtn.textContent='Load more';
        }
      }

      card(p){
        const name  = safe(p.name||'Beauty product');
        const brand = safe(p.brand||'Salon Pro');
        const price = formatPrice(p.price);
        const was   = (p.was!==undefined&&p.was!==null&&p.was!=='') ? formatPrice(p.was) : '';
        const badge = p.category ? `<span class="badge">${safe(p.category)}</span>` : '';
        const img   = p.image||p.img;

        const el = document.createElement('div');
        el.className='card';
        el.innerHTML = `
          ${img ? `<img src="${img}" alt="${name}" style="width:100%;height:144px;object-fit:cover">` : `<div class="imgph">No image</div>`}
          <div class="meta">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px">
              <div>
                <div class="brand">${brand}</div>
                <div class="name">${name}</div>
              </div>
              ${badge}
            </div>
            <div class="row"><div class="price">${price}</div><div class="was">${was}</div></div>
            <div class="btn-line">
              <button class="btn btn-subtle" data-action="details" style="flex:1">Details</button>
              <button class="btn btn-accent" data-action="add" style="flex:1">Add</button>
            </div>
          </div>
        `;

        el.querySelector('[data-action="details"]').addEventListener('click', ()=>{
          const bits=[];
          if (p.description)  bits.push(p.description);
          if (p.usage)        bits.push('Usage: '+p.usage);
          if (p.ingredients)  bits.push('Key ingredients: '+p.ingredients);
          if (p.suitableFor)  bits.push('Perfect for: '+p.suitableFor);
          alert(`${name}\n\n${bits.join('\n\n')||'Professional salon product designed for optimal results.'}`);
        });

        el.querySelector('[data-action="add"]').addEventListener('click', ()=>{
          alert('Added to bag (demo)');
        });

        return el;
      }
    }

    // ---------------- App wiring ----------------
    const ui = { cat:null };

    function handleAsk(){
      const q = ($('#aiInput')?.value||'').trim();
      if (!q){
        addBubble('bot','Try: ‚ÄúBest makeup for pale skin with cool undertones.‚Äù');
        return;
      }
      askInPlace(q);
    }

    function applyFilter(term){
      const sb = $('#searchBox');
      sb.value = term;
      ui.cat.query = term;
      ui.cat.offset = 0;
      ui.cat.render(true);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // subtle logo pulse
      const logo = document.querySelector('.logo');
      setInterval(()=>{ logo.style.transform='scale(1.02)'; setTimeout(()=>logo.style.transform='',180); }, 3000);

      // build catalog
      ui.cat = new Catalog();

      // ask handlers
      $('#aiInput')?.addEventListener('keydown', e=>{ if(e.key==='Enter') handleAsk(); });
      $('#askBtn')?.addEventListener('click', handleAsk);
      $('#consultBtn')?.addEventListener('click', handleAsk);

      // quick actions ‚Üí ask + filter
      $('#quickGrid')?.addEventListener('click', (e)=>{
        const card = e.target.closest('.action-card');
        if (!card) return;
        const preset = card.getAttribute('data-preset');
        const filter = card.getAttribute('data-filter');
        // visual tap
        card.style.transform='scale(0.96)'; setTimeout(()=> card.style.transform='',110);
        if (preset) askInPlace(preset);
        if (filter) applyFilter(filter);
      });

      // basket demo
      $('#basketBtn')?.addEventListener('click', ()=>{
        alert('üõí Your Beauty Basket:\n\n‚Ä¢ K-Beauty Serum - $29.99\n‚Ä¢ French Moisturizer - $45.50\n‚Ä¢ Vitamin C Complex - $52.01\n\nTotal: $127.50\n\nCheckout coming soon!');
      });

      // bottom nav (no external pages; keep user on index)
      document.querySelectorAll('.nav-item').forEach(nav=>{
        nav.addEventListener('click', ()=>{
          document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
          nav.classList.add('active');
          const id = nav.dataset.nav;
          if (id==='ask'){ document.getElementById('aiInput')?.focus(); }
          else if (id==='catalog'){ window.scrollTo({top: document.getElementById('results').offsetTop-20, behavior:'smooth'}); }
          else if (id==='signin' || id==='create'){ alert('Coming soon'); }
          else { window.scrollTo({top:0,behavior:'smooth'}); }
        });
      });
    });
  </script>
</body>
</html>
