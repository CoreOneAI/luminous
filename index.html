<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Luminous AI - Your Radiant Beauty Companion</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#B8860B" />
  <link rel="manifest" href="manifest.json" />
  <script>
    // Splash first-load redirect
    const splashShown = sessionStorage.getItem('splashShown');
    if (!splashShown) window.location.href = '/splash.html';
  </script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary-charcoal:#2C2C2C;
      --luminous-gold:#B8860B;
      --pearl-white:#F8F8F8;
      --premium-gradient:linear-gradient(135deg,#B8860B,#DAA520);
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:var(--primary-charcoal);
      color:#333;min-height:100vh;overflow-x:hidden
    }
    .container{max-width:414px;margin:0 auto;background:var(--primary-charcoal);min-height:100vh;position:relative}
    .header{background:var(--primary-charcoal);padding:20px;text-align:center;border-bottom:1px solid #3A3A3A}
    .logo{font-size:28px;font-weight:700;margin-bottom:8px;
      background:var(--premium-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .tagline{font-size:14px;color:var(--luminous-gold);font-weight:500;opacity:.9}
    .main-content{background:var(--pearl-white);min-height:calc(100vh - 120px);padding:20px}
    .welcome-section{background:#fff;border-radius:16px;padding:24px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,.1);text-align:center}
    .welcome-title{font-size:20px;font-weight:700;color:var(--primary-charcoal);margin-bottom:8px}
    .welcome-subtitle{font-size:14px;color:#666;margin-bottom:16px}
    .ai-search-container{margin-bottom:12px}
    .ai-search-bar{background:#fff;border-radius:25px;padding:12px 14px;display:flex;align-items:center;gap:10px;
      box-shadow:0 4px 12px rgba(0,0,0,.08);border:2px solid var(--luminous-gold)}
    .ai-icon{font-size:18px;color:var(--luminous-gold)}
    .ai-input{flex:1;border:none;outline:none;font-size:14px;background:transparent;color:#222}
    .ai-input::placeholder{color:#999;font-style:italic}
    .ai-send-btn{background:var(--premium-gradient);border:none;border-radius:20px;width:40px;height:40px;display:flex;align-items:center;
      justify-content:center;color:#fff;cursor:pointer;transition:.2s}
    .ai-send-btn:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(184,134,11,.3)}
    .chat-btn{background:var(--premium-gradient);color:#fff;border:none;padding:14px 22px;border-radius:22px;font-weight:600;font-size:16px;
      cursor:pointer;width:100%;box-shadow:0 4px 12px rgba(184,134,11,.25);transition:.2s}
    .chat-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(184,134,11,.35)}

    .quick-actions{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:16px 0 20px}
    .action-card{background:#fff;border-radius:12px;padding:8px 6px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.1);
      transition:.2s;cursor:pointer;position:relative;min-height:60px;display:flex;flex-direction:column;justify-content:center}
    .action-card:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.15)}
    .premium-feature{background:linear-gradient(135deg,#FFF9E6,#FFFFFF);border:1px solid var(--luminous-gold)}
    .premium-star{position:absolute;top:3px;right:3px;font-size:8px;color:var(--luminous-gold)}
    .action-icon{width:28px;height:28px;border-radius:14px;background:var(--premium-gradient);display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;margin:0 auto 4px}
    .action-title{font-size:10px;font-weight:600;color:#222;margin-bottom:2px;line-height:1.1}
    .action-subtitle{font-size:8px;color:#666;line-height:1.1}

    .featured-section{background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.1);margin-bottom:16px}
    .featured-header{background:var(--premium-gradient);color:#fff;padding:14px;text-align:center}
    .featured-title{font-size:16px;font-weight:700;margin-bottom:2px}
    .featured-subtitle{font-size:12px;opacity:.9}
    .featured-content{padding:16px;text-align:center}
    .feature-card{background:#F3F4F6;border-radius:12px;padding:14px;cursor:pointer}
    .feature-icon{font-size:22px;margin-bottom:6px}
    .feature-title{font-size:12px;font-weight:600;color:#222;margin-bottom:4px}
    .feature-desc{font-size:10px;color:#666}

    /* Chat card (IN-PAGE) */
    .chat-card{background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.1);padding:14px}
    .chat-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .chat-title{font-size:14px;font-weight:700;color:#222}
    .chat-status{font-size:11px;color:#888}
    .chat-thread{max-height:300px;overflow:auto;padding:6px;scroll-behavior:smooth}
    .bubble{display:inline-block;max-width:80%;padding:10px 12px;border-radius:14px;font-size:14px;line-height:1.35;margin:6px 0;
      box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .bubble.user{margin-left:auto;background:rgba(184,134,11,.12);border:1px solid rgba(184,134,11,.35)}
    .bubble.bot{margin-right:auto;background:#fff;border:1px solid #eee}
    .typing{display:inline-flex;gap:4px;align-items:center}
    .dot{width:6px;height:6px;background:#aaa;border-radius:50%;animation:blink 1.2s infinite ease-in-out}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.3}40%{opacity:1}}

    .bottom-nav{background:#fff;height:80px;display:flex;align-items:center;justify-content:space-around;border-top:1px solid #E0E0E0;
      padding-bottom:20px;position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:414px}
    .nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;color:#666;cursor:pointer}
    .nav-item.active{color:var(--luminous-gold)}
    .nav-icon{width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:20px}
    .nav-label{font-size:10px;font-weight:500}

    @media (max-width:380px){
      .quick-actions{grid-template-columns:1fr 1fr;gap:12px}
      .action-card{min-height:80px;padding:12px 8px}
      .action-title{font-size:11px}
      .action-subtitle{font-size:9px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">‚ú® Luminous AI</div>
      <div class="tagline">Your Radiant Beauty Companion</div>
    </div>

    <!-- Main -->
    <div class="main-content">
      <!-- Welcome -->
      <div class="welcome-section">
        <div class="welcome-title">Welcome to Your Beauty Journey</div>
        <div class="welcome-subtitle">Get personalized AI-powered beauty recommendations from global experts</div>

        <!-- Ask AI -->
        <div class="ai-search-container">
          <div class="ai-search-bar">
            <div class="ai-icon">ü§ñ</div>
            <input id="aiInput" class="ai-input" placeholder="Ask: ‚ÄòBest anti-aging serum for sensitive skin‚Äô" />
            <button id="askBtn" class="ai-send-btn" title="Ask"><span>‚ú®</span></button>
          </div>
        </div>

        <button class="chat-btn" id="consultBtn">üåü Start Beauty Consultation</button>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions" id="quickGrid">
        <div class="action-card premium-feature" data-preset="Recommend an anti-aging routine for sensitive, dry skin. Focus on gentle actives and SPF.">
          <div class="premium-star">‚≠ê</div>
          <div class="action-icon">üßò</div>
          <div class="action-title">Anti-aging</div>
          <div class="action-subtitle">Wellness & skincare</div>
        </div>
        <div class="action-card" data-preset="Best eye care regimen to reduce puffiness and dark circles, fragrance-free.">
          <div class="action-icon">üëÅÔ∏è</div>
          <div class="action-title">Eye Care</div>
          <div class="action-subtitle">2,000+ eye products</div>
        </div>
        <div class="action-card premium-feature" data-preset="Give me a skin analysis checklist to share with my stylist before an appointment.">
          <div class="premium-star">‚≠ê</div>
          <div class="action-icon">‚ú®</div>
          <div class="action-title">Skin Analysis</div>
          <div class="action-subtitle">AI recommendations</div>
        </div>
        <div class="action-card premium-feature" data-preset="Suggest a facial plan for dullness and texture with gentle exfoliation.">
          <div class="premium-star">‚≠ê</div>
          <div class="action-icon">üòä</div>
          <div class="action-title">Facial Analysis</div>
          <div class="action-subtitle">AI face scanning</div>
        </div>
        <div class="action-card" data-preset="Show current beauty trends and viral looks; add approachable options for everyday wear.">
          <div class="action-icon">üè∑Ô∏è</div>
          <div class="action-title">Discounts</div>
          <div class="action-subtitle">discount products</div>
        </div>
        <div class="action-card" data-preset="Nail care routine for brittle nails plus polish shades for cool undertones.">
          <div class="action-icon">üíÖ</div>
          <div class="action-title">Nail Care</div>
          <div class="action-subtitle">2,000+ nail products</div>
        </div>
        <div class="action-card" data-preset="Useful beauty tools and accessories for travel: compact, TSA-friendly.">
          <div class="action-icon">üíé</div>
          <div class="action-title">Accessories</div>
          <div class="action-subtitle">2,000+ beauty tools</div>
        </div>
        <div class="action-card" id="basketBtn">
          <div class="action-icon">üõí</div>
          <div class="action-title">Basket</div>
          <div class="action-subtitle">3 items ‚Ä¢ $127.50</div>
          <div class="basket-count">3</div>
        </div>
      </div>

      <!-- In-page Chat Card -->
      <div class="chat-card" id="chatCard" aria-live="polite">
        <div class="chat-head">
          <div class="chat-title">AI Suggestions</div>
          <div class="chat-status" id="chatStatus">Ready</div>
        </div>
        <div class="chat-thread" id="chatThread"></div>
      </div>

      <!-- Catalog promos (unchanged copy) -->
      <div class="featured-section" style="margin-top:16px;">
        <div class="featured-header">
          <div class="featured-title">Beauty Catalog</div>
          <div class="featured-subtitle">Curated American Collections</div>
        </div>
        <div class="featured-content">
          <div class="feature-card" id="globalBtn">
            <div class="feature-icon">üåç</div>
            <div class="feature-title">Global Beauty Products</div>
            <div class="feature-desc">Discover products from around the world</div>
          </div>
        </div>
      </div>

      <!-- Recommendations CTA -->
      <div class="featured-section">
        <div class="featured-header">
          <div class="featured-title">Recommendations</div>
          <div class="featured-subtitle">Personalized suggestions</div>
        </div>
        <div class="featured-content">
          <div class="feature-card" id="recCard">
            <div class="feature-icon">‚ú®</div>
            <div class="feature-title">Get Personalized Suggestions</div>
            <div class="feature-desc">Create account or login for AI recommendations</div>
          </div>
        </div>
      </div>

      <div style="height:100px;"></div>
    </div>

    <!-- Bottom nav -->
    <div class="bottom-nav">
      <div class="nav-item active" data-nav="home">
        <div class="nav-icon">üè†</div><div class="nav-label">Home</div>
      </div>
      <div class="nav-item" data-nav="signin">
        <div class="nav-icon">üîë</div><div class="nav-label">Sign In</div>
      </div>
      <div class="nav-item" data-nav="createaccount">
        <div class="nav-icon">üë§</div><div class="nav-label">Create Account</div>
      </div>
      <div class="nav-item" data-nav="catalog">
        <div class="nav-icon">üåç</div><div class="nav-label">Catalog</div>
      </div>
      <div class="nav-item" data-nav="askme">
        <div class="nav-icon">üí¨</div><div class="nav-label">Ask Me</div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Small helpers ----------
    const $ = (s, r=document)=>r.querySelector(s);
    const chatThread = $('#chatThread');
    const chatStatus = $('#chatStatus');
    const askBtn = $('#askBtn');
    const aiInput = $('#aiInput');

    // Endpoints: prefer /ask, then /api/chat, then /chat
    const CHAT_ENDPOINTS = ['/ask','/api/chat','/chat'];

    function setStatus(txt){ chatStatus.textContent = txt; }

    function addBubble(role, text, {typing=false}={}){
      const wrap = document.createElement('div');
      wrap.className = `bubble ${role}`;
      if (typing){
        wrap.innerHTML = `<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
      } else {
        wrap.textContent = text;
      }
      chatThread.appendChild(wrap);
      chatThread.scrollTop = chatThread.scrollHeight;
      return wrap;
    }

    async function typeText(el, text, speed=14){
      el.textContent = '';
      for (let i=0;i<text.length;i++){
        el.textContent += text[i];
        if (i % 3 === 0) await new Promise(r=>setTimeout(r, speed));
        chatThread.scrollTop = chatThread.scrollHeight;
      }
    }

    async function askBackend(message){
      let lastErr=null;
      for (const ep of CHAT_ENDPOINTS){
        try{
          const r = await fetch(ep, {
            method:'POST',
            headers:{'Content-Type':'application/json','Accept':'application/json'},
            body: JSON.stringify({ message, includeProducts:false })
          });
          if (!r.ok) throw new Error('HTTP '+r.status);
          const data = await r.json().catch(()=> ({}));
          return data.reply || data.response || data.text || 'Sorry, no answer available.';
        }catch(e){ lastErr=e; }
      }
      throw lastErr||new Error('All endpoints failed');
    }

    async function ask(message){
      if (!message) return;
      setStatus('Thinking‚Ä¶');
      // user bubble
      addBubble('user', message);
      // bot typing bubble
      const t = addBubble('bot','',{typing:true});
      try{
        const reply = await askBackend(message);
        // replace typing bubble with typewriter text
        t.innerHTML = '';
        await typeText(t, reply, 10);
      }catch(e){
        t.innerHTML = '';
        await typeText(t, '‚ö†Ô∏è Could not reach AI. Please try again.');
      }finally{
        setStatus('Ready');
      }
    }

    // ---------- UI wiring ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      // animate logo a touch
      const logo=$('.logo');
      setInterval(()=>{logo.style.transform='scale(1.02)';setTimeout(()=>logo.style.transform='',200);},3000);

      // input enter
      aiInput?.addEventListener('keydown', e=>{ if(e.key==='Enter'){ handleAsk(); }});
      askBtn?.addEventListener('click', handleAsk);
      $('#consultBtn')?.addEventListener('click', handleAsk);

      // quick action cards -> ask in-place (no navigation)
      $('#quickGrid')?.addEventListener('click', (e)=>{
        const card = e.target.closest('.action-card');
        if (!card) return;
        const q = card.getAttribute('data-preset');
        // tap feedback
        card.style.transform='scale(0.96)'; setTimeout(()=> card.style.transform='',120);
        if (q) ask(q);
      });

      // global products promo ‚Äî keep as navigation if you want
      $('#globalBtn')?.addEventListener('click', ()=>{ location.href='/catalog.html'; });

      // recommendations CTA
      $('#recCard')?.addEventListener('click', ()=>{
        const profile = JSON.parse(localStorage.getItem('userProfile')||'{}');
        if (profile.name && profile.email && profile.password) location.href='account.html';
        else showAccountPrompt();
      });

      // bottom nav
      document.querySelectorAll('.nav-item').forEach(nav=>{
        nav.addEventListener('click', ()=>{
          document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
          nav.classList.add('active');
          switch(nav.dataset.nav){
            case 'home': location.href='/index.html'; break;
            case 'signin': location.href='/signin.html'; break;
            case 'createaccount': location.href='/createaccount.html'; break;
            case 'catalog': location.href='/catalog.html'; break;
            case 'askme': location.href='/askme.html'; break;
          }
        });
      });

      // demo basket
      $('#basketBtn')?.addEventListener('click', ()=>{
        alert('üõí Your Beauty Basket:\n\n‚Ä¢ K-Beauty Serum - $29.99\n‚Ä¢ French Moisturizer - $45.50\n‚Ä¢ Vitamin C Complex - $52.01\n\nTotal: $127.50\n\nCheckout coming soon!');
      });
    });

    function handleAsk(){
      const q = ($('#aiInput')?.value||'').trim();
      if (!q) { addBubble('bot','Try: ‚ÄúBest makeup for pale skin with cool undertones.‚Äù'); return; }
      ask(q);
    }

    function showAccountPrompt(){
      const html = `
      <div style="position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:10000;display:flex;align-items:center;justify-content:center;padding:20px;" onclick="this.remove()">
        <div style="background:#fff;border-radius:20px;padding:28px;max-width:350px;text-align:center;" onclick="event.stopPropagation()">
          <div style="font-size:44px;margin-bottom:14px;">‚ú®</div>
          <h2 style="color:#2c2c2c;margin-bottom:10px;font-size:20px;">Get Personalized Recommendations</h2>
          <p style="color:#666;margin-bottom:18px;line-height:1.5;">Create an account or sign in to receive AI-powered beauty recommendations tailored just for you!</p>
          <div style="display:flex;flex-direction:column;gap:10px;">
            <button onclick="location.href='createaccount.html'" style="background:linear-gradient(135deg,#B8860B,#DAA520);color:#fff;border:none;padding:12px 20px;border-radius:22px;font-weight:600;cursor:pointer;font-size:15px;">Create Account</button>
            <button onclick="location.href='signin.html'" style="background:#f0f0f0;color:#333;border:none;padding:12px 20px;border-radius:22px;font-weight:600;cursor:pointer;font-size:15px;">Sign In</button>
            <button onclick="document.querySelector('[style*=&quot;z-index: 10000&quot;]')?.remove()" style="background:none;border:none;color:#888;padding:8px;cursor:pointer;font-size:13px;">Maybe Later</button>
          </div>
        </div>
      </div>`;
      document.body.insertAdjacentHTML('beforeend', html);
    }
  </script>
</body>
</html>
