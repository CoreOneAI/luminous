<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luminous Salon</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* Browser Background */
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    /* Phone Container */
    .phone-frame {
      width: 375px;
      height: 812px;
      background: #000;
      border-radius: 40px;
      padding: 10px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
    }
    
    /* Phone Screen */
    .phone-screen {
      width: 100%;
      height: 100%;
      background: #fff;
      border-radius: 30px;
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    /* Flutter AppBar */
    .app-bar {
      background: #000;
      color: #fff;
      height: 56px;
      display: flex;
      align-items: center;
      padding: 0 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .app-bar-leading {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .app-bar-title {
      flex: 1;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
      margin-right: 48px;
    }
    
    /* Flutter Scaffold Body */
    .scaffold-body {
      flex: 1;
      overflow-y: auto;
      background: #fafafa;
      position: relative;
    }
    
    /* Grid View */
    .grid-view {
      padding: 8px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    /* Category Cards */
    .category-card {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
      text-decoration: none;
      color: inherit;
      cursor: pointer;
    }
    
    .category-image {
      width: 100%;
      height: 100px;
      position: relative;
      overflow: hidden;
    }
    
    .category-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .category-card:hover .category-image img {
      transform: scale(1.05);
    }
    
    .category-body {
      padding: 10px;
    }
    
    .category-title {
      font-size: 13px;
      font-weight: 600;
      color: 212121;
      margin: 4px 0;
      line-height: 1.2;
    }
    
    .category-subtitle {
      font-size: 11px;
      color: #757575;
      line-height: 1.2;
    }
    
    /* Hero Banner */
    .hero-banner {
      background: linear-gradient(135deg, #000 0%, #333 100%);
      color: #fff;
      padding: 16px;
      margin: 8px;
      border-radius: 12px;
    }
    
    .hero-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .hero-text {
      font-size: 12px;
      opacity: 0.9;
    }
    
    /* Quick Actions */
    .quick-actions {
      padding: 8px;
      display: flex;
      gap: 8px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .quick-actions::-webkit-scrollbar {
      display: none;
    }
    
    .action-button {
      flex: 0 0 auto;
      padding: 8px 16px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .action-button:active {
      background: #333;
    }
    
    /* Section Label */
    .section-label {
      padding: 12px 12px 4px;
      font-size: 14px;
      font-weight: 600;
      color: #000;
    }
    
    /* Products Scroll */
    .products-scroll {
      padding: 8px;
      display: flex;
      gap: 8px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    
    .products-scroll::-webkit-scrollbar {
      display: none;
    }
    
    .mini-product {
      flex: 0 0 120px;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
      cursor: pointer;
    }
    
    .mini-product-image {
      width: 100%;
      height: 80px;
      position: relative;
      overflow: hidden;
    }
    
    .mini-product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .mini-product-info {
      padding: 8px;
    }
    
    .mini-product-name {
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .mini-product-price {
      font-size: 13px;
      font-weight: 700;
      color: #000;
    }
    
    /* Promo Card */
    .promo-card {
      margin: 8px;
      padding: 12px;
      background: linear-gradient(135deg, #000000 0%, #000000 100%);
      border-radius: 12px;
      color: #fff;
    }
    
    .promo-title {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 2px;
      color: #C9A961;
    }
    
    .promo-text {
      font-size: 11px;
      opacity: 0.95;
    }
    
    /* Bottom Navigation */
    .bottom-nav {
      background: #fff;
      height: 56px;
      border-top: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: space-around;
    }
    
    .nav-item {
      flex: 1;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #757575;
      transition: all 0.2s;
      text-decoration: none;
    }
    
    .nav-item.active {
      color: #000;
    }
    
    .nav-label {
      font-size: 10px;
      font-weight: 500;
    }
    
    /* Floating Action Button */
    .fab {
      position: absolute;
      bottom: 70px;
      right: 16px;
      width: 56px;
      height: 56px;
      background: #000;
      color: #fff;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      cursor: pointer;
      font-size: 24px;
      z-index: 10;
      transition: all 0.2s;
    }
    
    .fab:hover {
      transform: scale(1.05);
    }
    
    .fab:active {
      transform: scale(0.95);
    }
    
    /* Chat Container Styles */
    .chat-container {
      padding: 8px;
    }
    
    .chat-box {
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    
    .chat-messages {
      height: 200px;
      overflow-y: auto;
      background: #f9f9f9;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
    }
    
    .chat-message {
      padding: 8px;
      margin: 4px 0;
      border-radius: 8px;
      font-size: 12px;
      max-width: 80%;
    }
    
    .chat-message.bot {
      background: #e0e0e0;
      align-self: flex-start;
    }
    
    .chat-message.user {
      background: #000;
      color: white;
      align-self: flex-end;
      margin-left: auto;
    }
    
    .chat-input-container {
      display: flex;
      gap: 8px;
    }
    
    .chat-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 13px;
    }
    
    .chat-send {
      padding: 10px 20px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Search Container */
    .search-container {
      padding: 8px;
    }
    
    .search-box {
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    
    .search-input-container {
      display: flex;
      gap: 8px;
    }
    
    .search-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 13px;
    }
    
    .search-button {
      padding: 10px 20px;
      background: #C9A961;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
    }
    
    .product-modal {
      background: white;
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
      z-index: 1001;
    }
    
    /* Responsive */
    @media (max-width: 425px) {
      .phone-frame {
        width: 100%;
        height: 100vh;
        border-radius: 0;
        padding: 0;
      }
      
      .phone-screen {
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Phone Frame Container -->
  <div class="phone-frame">
    <div class="phone-screen">
      
      <!-- Flutter AppBar -->
      <div class="app-bar">
        <div class="app-bar-leading">
          <span style="font-size: 20px;">🔔</span>
        </div>
        <div class="app-bar-title">Luminous Salon</div>
      </div>
      
      <!-- Main View -->
      <div class="scaffold-body" id="mainView">
        
        <!-- Hero Banner -->
        <div class="hero-banner">
          <div class="hero-title">Welcome to Luminous</div>
          <div class="hero-text">Your premier beauty destination</div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
          <button class="action-button" onclick="bookNow()">
            <span style="font-size: 16px;">📅</span> Book Now
          </button>
          <button class="action-button" onclick="callUs()">
            <span style="font-size: 16px;">📞</span> Call Us
          </button>
          <button class="action-button" onclick="viewOffers()">
            <span style="font-size: 16px;">🎁</span> Services
          </button>
          <button class="action-button" onclick="rewards()">
            <span style="font-size: 16px;">⭐</span> Rewards
          </button>
        </div>
        
        <!-- AI Chat Section -->
        <div class="section-label">Ask Our Beauty Expert</div>
        <div class="chat-container">
          <div class="chat-box">
            <div id="chatContainer" class="chat-messages">
              <div class="chat-message bot">
                Welcome! Ask me anything about skincare, haircare, or beauty treatments.
              </div>
            </div>
            
            <div class="chat-input-container">
              <input id="chatInput" type="text" placeholder="Ask about treatments, products, or beauty advice..." 
                     class="chat-input" onkeypress="if(event.key === 'Enter') sendChat()">
              <button onclick="sendChat()" class="chat-send">Send</button>
            </div>
          </div>
        </div>
        
        <!-- Product Search Bar -->
        <div class="section-label">Search Products</div>
        <div class="search-container">
          <div class="search-box">
            <div class="search-input-container">
              <input id="productSearch" type="text" placeholder="Search for specific products..." 
                     class="search-input" onkeypress="if(event.key === 'Enter') searchProducts()">
              <button onclick="searchProducts()" class="search-button">Search</button>
            </div>
          </div>
        </div>
        
        <!-- Shop Categories -->
        <div class="section-label">Shop by Category</div>
        <div class="grid-view">
          <div class="category-card" onclick="showProducts('Anti-Aging')">
            <div class="category-image">
              <img src="/images/anti-aging.jpg" alt="Anti-Aging" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Anti-Aging</div>
              <div class="category-subtitle">Retinol & peptide treatments</div>
            </div>
          </div>
          
          <div class="category-card" onclick="showProducts('Skin Care')">
            <div class="category-image">
              <img src="/images/skin-care.jpg" alt="Skin Care" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Skin Care</div>
              <div class="category-subtitle">Cleansers & toners</div>
            </div>
          </div>
          
          <div class="category-card" onclick="showProducts('Eye Care')">
            <div class="category-image">
              <img src="/images/eye-care.jpg" alt="Eye Care" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Eye Care</div>
              <div class="category-subtitle">Serums & treatments</div>
            </div>
          </div>
          
          <div class="category-card" onclick="showProducts('Brightening')">
            <div class="category-image">
              <img src="/images/brightening.jpg" alt="Brightening" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Brightening</div>
              <div class="category-subtitle">Vitamin C & glow products</div>
            </div>
          </div>

          <div class="category-card" onclick="showProducts('Daily Protection')">
            <div class="category-image">
              <img src="/images/daily-protection.jpg" alt="Daily Protection" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Daily Protection</div>
              <div class="category-subtitle">SPF & sun care</div>
            </div>
          </div>
          
          <div class="category-card" onclick="showProducts('Night Cream')">
            <div class="category-image">
              <img src="/images/night-cream.jpg" alt="Night Cream" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Night Cream</div>
              <div class="category-subtitle">Overnight repair</div>
            </div>
          </div>

          <div class="category-card" onclick="showProducts('Eye')">
            <div class="category-image">
              <img src="/images/targeted-eye.jpg" alt="Targeted Eye" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Targeted Eye</div>
              <div class="category-subtitle">Specialized eye treatments</div>
            </div>
          </div>
          
          <div class="category-card" onclick="showProducts('all')">
            <div class="category-image">
              <img src="/images/all-products.jpg" alt="All Products" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">All Products</div>
              <div class="category-subtitle">Browse everything</div>
            </div>
          </div>
        </div>
        
        <!-- Promo -->
        <div class="promo-card">
          <div class="promo-title">New Client Special</div>
          <div class="promo-text">Get 20% off your first treatment + free consultation</div>
        </div>
        
        <!-- Featured Products -->
        <div class="section-label">Bestsellers</div>
        <div class="products-scroll" id="featuredProducts">
          <!-- Products will be loaded here -->
        </div>
        
        <!-- Services -->
        <div class="section-label">Our Services</div>
        <div class="grid-view">
          <div class="category-card" onclick="bookService('color')">
            <div class="category-image">
              <img src="/images/hair-color.jpg" alt="Color & Highlights" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Color & Highlights</div>
              <div class="category-subtitle">Starting at $120</div>
            </div>
          </div>
          
          <div class="category-card" onclick="bookService('styling')">
            <div class="category-image">
              <img src="/images/styling-makeup.jpg" alt="Styling & Makeup" onerror="handleImageError(this)">
            </div>
            <div class="category-body">
              <div class="category-title">Styling & Makeup</div>
              <div class="category-subtitle">Starting at $85</div>
            </div>
          </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="fab" onclick="openAI()">💬</div>
        
      </div>
      
      <!-- Bottom Navigation -->
      <div class="bottom-nav">
        <a class="nav-item active" onclick="goHome()">
          <span style="font-size: 20px;">🏠</span>
          <div class="nav-label">Home</div>
        </a>
        <a class="nav-item" onclick="navigateTo('services')">
          <span style="font-size: 20px;">✂️</span>
          <div class="nav-label">Services</div>
        </a>
        <a class="nav-item" onclick="navigateTo('products')">
          <span style="font-size: 20px;">🛍️</span>
          <div class="nav-label">Products</div>
        </a>
        <a class="nav-item" onclick="showProfile()">
          <span style="font-size: 20px;">👤</span>
          <div class="nav-label">Profile</div>
        </a>
      </div>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div class="modal-overlay" id="modalOverlay" onclick="closeModal()"></div>

  <script>
    // Current cart
    let cart = {
        items: [],
        total: 0
    };

    // Handle image errors
    function handleImageError(img) {
        img.style.display = 'none';
    }

    // Load products from API
    async function loadProducts() {
        try {
            const response = await fetch('/api/products');
            const data = await response.json();
            
            // Handle different response structures
            const products = data.items || data.products || [];
            
            if (products.length > 0) {
                displayProducts(products.slice(0, 6));
            } else {
                displayProducts(getFallbackProducts().slice(0, 6));
            }
        } catch (error) {
            console.error('Error loading products:', error);
            displayProducts(getFallbackProducts().slice(0, 6));
        }
    }

    // Show products by category - FIXED to handle your actual product categories
    async function showProducts(category) {
        try {
            let url = '/api/products';
            if (category !== 'all') {
                url += `?category=${encodeURIComponent(category)}`;
            }
            
            const response = await fetch(url);
            const data = await response.json();
            
            // Handle different response structures
            const products = data.items || data.products || [];
            
            if (products.length > 0) {
                showProductsModal(products, category);
            } else {
                // Show modal with fallback products for that category
                showProductsModal(getProductsByCategory(category), category);
            }
        } catch (error) {
            console.error('Error loading products:', error);
            // Show fallback products
            showProductsModal(getProductsByCategory(category), category);
        }
    }

    // Get products by category from your actual data
    function getProductsByCategory(category) {
        const allProducts = getAllProducts();
        if (category === 'all') return allProducts;
        
        return allProducts.filter(product => 
            product.category && product.category.toLowerCase() === category.toLowerCase()
        );
    }

    // Get all products from your actual data
    function getAllProducts() {
        return [
            {
                id: "aa-retinol-serum-001",
                name: "Retinol Renewal Serum 0.3%",
                brand: "Luminous Lab",
                category: "Anti-Aging",
                price: 39.00,
                description: "Gentle retinol serum for first-time users. Softens fine lines and improves texture.",
                image: "/images/0010.jpg"
            },
            {
                id: "aa-retinol-cream-002",
                name: "Pro Retinol Night Cream",
                brand: "Salon Pro",
                category: "Anti-Aging",
                price: 46.00,
                description: "Rich, cushiony night cream with encapsulated retinol and ceramides.",
                image: "/images/0014CC.jpg"
            },
            {
                id: "ec-retinol-eye-001",
                name: "Retinol Eye Treatment",
                brand: "Salon Pro",
                category: "Eye Care",
                price: 34.00,
                description: "Low-irritation retinol eye cream to smooth crow's feet and brighten tone.",
                image: "/images/hispanic-american.jpg"
            },
            {
                id: "ec-ceramide-eye-002",
                name: "Ceramide Eye Repair Gel",
                brand: "Luminous Lab", 
                category: "Eye Care",
                price: 22.00,
                description: "Cooling gel with caffeine and ceramides for morning depuff and long-lasting hydration.",
                image: "/images/black-americanfemale.jpg"
            },
            {
                id: "sc-balancing-002",
                name: "Balancing Gel Cleanser", 
                brand: "Salon Pro",
                category: "Skin Care",
                price: 14.00,
                description: "pH-balanced gel cleanser that removes makeup without stripping.",
                image: "/images/0014CC.jpg"
            },
            {
                id: "vc-serum-001",
                name: "Vitamin C 15% Bright Serum",
                brand: "Luminous Lab",
                category: "Brightening",
                price: 32.00,
                description: "Water-light L-ascorbic acid + ferulic + E to boost radiance and even tone.",
                image: "/images/0014CC.jpg"
            },
            {
                id: "spf-30-001",
                name: "Daily Mineral SPF 30",
                brand: "Luminous Lab",
                category: "Daily Protection",
                price: 21.00,
                description: "Non-nano zinc oxide with sheer finish. No white cast on most skin tones.",
                image: "/images/0010.jpg"
            },
            {
                id: "nc-ceramide-repair-001",
                name: "Ceramide Repair Night Cream",
                brand: "Luminous Lab",
                category: "Night Cream",
                price: 29.00,
                description: "Deep repair cream with ceramides + cholesterol for dry, stressed skin.",
                image: "/images/0014CC.jpg"
            },
            {
                id: "eye-targeted-001",
                name: "Peptide + C Eye Lift",
                brand: "Baine",
                category: "Eye",
                price: 31.00,
                description: "Targets puffiness and dull tone around the eyes for a rested look.",
                image: "/images/hispanic-american.jpg"
            }
        ];
    }

    // Show products in a modal
    function showProductsModal(products, category) {
        // Remove any existing modals first
        document.querySelectorAll('.modal-overlay').forEach(el => el.remove());
        
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.right = '0';
        overlay.style.bottom = '0';
        overlay.style.background = 'rgba(0,0,0,0.8)';
        overlay.style.zIndex = '1000';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        overlay.onclick = () => document.body.removeChild(overlay);
        
        const modal = document.createElement('div');
        modal.style.background = 'white';
        modal.style.padding = '20px';
        modal.style.borderRadius = '12px';
        modal.style.maxWidth = '90%';
        modal.style.maxHeight = '80%';
        modal.style.overflowY = 'auto';
        modal.onclick = (e) => e.stopPropagation();
        
        const title = document.createElement('h3');
        title.textContent = `${category} Products (${products.length})`;
        title.style.marginBottom = '15px';
        title.style.textAlign = 'center';
        modal.appendChild(title);
        
        if (products.length === 0) {
            const noProducts = document.createElement('div');
            noProducts.textContent = 'No products found in this category.';
            noProducts.style.textAlign = 'center';
            noProducts.style.color = '#666';
            modal.appendChild(noProducts);
        } else {
            // Create product grid
            const productGrid = document.createElement('div');
            productGrid.style.display = 'grid';
            productGrid.style.gridTemplateColumns = 'repeat(2, 1fr)';
            productGrid.style.gap = '10px';
            
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.style.padding = '10px';
                productCard.style.background = '#f9f9f9';
                productCard.style.borderRadius = '8px';
                productCard.style.cursor = 'pointer';
                productCard.style.textAlign = 'center';
                productCard.onclick = (e) => {
                    e.stopPropagation();
                    showProductDetail(product);
                };
                
                const imageDiv = document.createElement('div');
                imageDiv.style.height = '60px';
                imageDiv.style.marginBottom = '8px';
                imageDiv.style.borderRadius = '6px';
                imageDiv.style.overflow = 'hidden';
                imageDiv.style.background = 'linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%)';
                
                if (product.image) {
                    const img = document.createElement('img');
                    img.src = product.image;
                    img.alt = product.name;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    img.onerror = function() {
                        this.style.display = 'none';
                        imageDiv.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 20px;">💄</div>';
                    };
                    imageDiv.appendChild(img);
                } else {
                    imageDiv.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 20px;">💄</div>';
                }
                
                const nameDiv = document.createElement('div');
                nameDiv.textContent = product.name.length > 20 ? product.name.substring(0, 20) + '...' : product.name;
                nameDiv.style.fontSize = '12px';
                nameDiv.style.fontWeight = '600';
                nameDiv.style.marginBottom = '5px';
                
                const priceDiv = document.createElement('div');
                priceDiv.textContent = `$${product.price.toFixed(2)}`;
                priceDiv.style.fontSize = '14px';
                priceDiv.style.fontWeight = '700';
                priceDiv.style.color = '#C9A961';
                
                productCard.appendChild(imageDiv);
                productCard.appendChild(nameDiv);
                productCard.appendChild(priceDiv);
                productGrid.appendChild(productCard);
            });
            
            modal.appendChild(productGrid);
        }
        
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
    }

    // Show individual product detail
    function showProductDetail(product) {
        // Remove any existing modals first
        document.querySelectorAll('.modal-overlay').forEach(el => el.remove());
        
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.right = '0';
        overlay.style.bottom = '0';
        overlay.style.background = 'rgba(0,0,0,0.8)';
        overlay.style.zIndex = '1000';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        overlay.onclick = () => document.body.removeChild(overlay);
        
        const modal = document.createElement('div');
        modal.style.background = 'white';
        modal.style.padding = '20px';
        modal.style.borderRadius = '12px';
        modal.style.maxWidth = '300px';
        modal.style.textAlign = 'center';
        modal.onclick = (e) => e.stopPropagation();
        
        const imageDiv = document.createElement('div');
        imageDiv.style.height = '120px';
        imageDiv.style.marginBottom = '15px';
        imageDiv.style.borderRadius = '8px';
        imageDiv.style.overflow = 'hidden';
        imageDiv.style.background = 'linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%)';
        
        if (product.image) {
            const img = document.createElement('img');
            img.src = product.image;
            img.alt = product.name;
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            img.onerror = function() {
                this.style.display = 'none';
                imageDiv.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 40px;">💄</div>';
            };
            imageDiv.appendChild(img);
        } else {
            imageDiv.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 40px;">💄</div>';
        }
        
        const nameDiv = document.createElement('h3');
        nameDiv.textContent = product.name;
        nameDiv.style.marginBottom = '10px';
        nameDiv.style.color = '#333';
        
        const priceDiv = document.createElement('div');
        priceDiv.textContent = `$${product.price.toFixed(2)}`;
        priceDiv.style.fontSize = '18px';
        priceDiv.style.fontWeight = '700';
        priceDiv.style.color = '#C9A961';
        priceDiv.style.marginBottom = '10px';
        
        const descDiv = document.createElement('div');
        descDiv.textContent = product.description || 'No description available.';
        descDiv.style.fontSize = '12px';
        descDiv.style.color = '#666';
        descDiv.style.marginBottom = '20px';
        descDiv.style.lineHeight = '1.4';
        
        const addButton = document.createElement('button');
        addButton.textContent = 'Add to Cart';
        addButton.style.background = '#C9A961';
        addButton.style.color = 'white';
        addButton.style.border = 'none';
        addButton.style.padding = '12px 20px';
        addButton.style.borderRadius = '8px';
        addButton.style.cursor = 'pointer';
        addButton.style.fontWeight = '600';
        addButton.onclick = (e) => {
            e.stopPropagation();
            addToCart(product);
            document.body.removeChild(overlay);
        };
        
        modal.appendChild(imageDiv);
        modal.appendChild(nameDiv);
        modal.appendChild(priceDiv);
        modal.appendChild(descDiv);
        modal.appendChild(addButton);
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
    }

    // Add to cart function
    function addToCart(product) {
        cart.items.push(product);
        cart.total += product.price;
        // Show brief notification instead of chat message
        const notification = document.createElement('div');
        notification.textContent = `✓ Added ${product.name} to cart`;
        notification.style.position = 'fixed';
        notification.style.bottom = '100px';
        notification.style.left = '50%';
        notification.style.transform = 'translateX(-50%)';
        notification.style.background = '#4CAF50';
        notification.style.color = 'white';
        notification.style.padding = '10px 20px';
        notification.style.borderRadius = '20px';
        notification.style.zIndex = '1001';
        document.body.appendChild(notification);
        
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 2000);
    }

    // Fallback products
    function getFallbackProducts() {
        return getAllProducts().slice(0, 6);
    }

    // Display featured products
    function displayProducts(products) {
        const container = document.getElementById('featuredProducts');
        if (!container) return;
        
        container.innerHTML = '';
        
        products.forEach(product => {
            const productElement = document.createElement('div');
            productElement.className = 'mini-product';
            productElement.onclick = () => showProductDetail(product);
            
            const imageHtml = product.image ? 
                `<img src="${product.image}" alt="${product.name}" onerror="handleImageError(this)">` :
                '<div style="font-size: 24px; display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);">💄</div>';
            
            productElement.innerHTML = `
                <div class="mini-product-image">
                    ${imageHtml}
                </div>
                <div class="mini-product-info">
                    <div class="mini-product-name">${product.name}</div>
                    <div class="mini-product-price">$${product.price.toFixed(2)}</div>
                </div>
            `;
            container.appendChild(productElement);
        });
    }

    // FIXED: Navigation functions
    function goHome() {
        document.getElementById('mainView').style.display = 'block';
        document.getElementById('profileView').style.display = 'none';
        updateNavActive(0);
    }

    function showServices() {
        showProducts('all');
    }

    function navigateTo(page) {
        if (page === 'services') {
            showServices();
        } else if (page === 'products') {
            showProducts('all');
        } else {
            alert(`${page} page would show here`);
        }
    }

    function showProfile() {
        document.getElementById('mainView').style.display = 'none';
        document.getElementById('profileView').style.display = 'block';
        updateNavActive(3);
    }

    function updateNavActive(index) {
        document.querySelectorAll('.nav-item').forEach((item, i) => {
            if (i === index) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
    }

    // Chat function with AI integration
    async function sendChat() {
        const input = document.getElementById('chatInput');
        if (!input) return;
        
        const message = input.value.trim();
        if (!message) return;
        
        addChatMessage('user', message);
        input.value = '';
        
        try {
            const response = await fetch('/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: message })
            });
            
            if (!response.ok) throw new Error(`API error: ${response.status}`);
            
            const data = await response.json();
            const aiReply = data.reply || data.choices?.[0]?.message?.content || "Sorry, I couldn't process that.";
            addChatMessage('bot', aiReply);
            
        } catch (error) {
            console.error('Chat error:', error);
            setTimeout(() => {
                addChatMessage('bot', "I'm here to help with beauty advice and product recommendations. What would you like to know?");
            }, 1000);
        }
    }

    function searchProducts() {
        const searchTerm = document.getElementById('productSearch').value.trim();
        if (searchTerm) {
            addChatMessage('user', `Search: ${searchTerm}`);
            document.getElementById('productSearch').value = '';
            
            setTimeout(() => {
                addChatMessage('bot', `Searching for "${searchTerm}"... Check our categories for related products!`);
            }, 1000);
        }
    }

    // Chat functions
    function addChatMessage(type, message) {
        const chatContainer = document.getElementById('chatContainer');
        if (!chatContainer) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${type}`;
        messageDiv.textContent = message;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Service functions
    function bookService(service) {
        alert(`Booking ${service} service...`);
    }

    function bookNow() { alert('Opening booking system...'); }
    function callUs() { alert('Calling (555) 123-4567...'); }
    function viewOffers() { alert('Viewing current offers...'); }
    function rewards() { alert('Viewing rewards program...'); }
    function openAI() { 
        const input = document.getElementById('chatInput');
        if (input) input.focus();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        loadProducts();
        addChatMessage('bot', 'Hello! I\'m your beauty assistant. Ask me about skincare, products, or salon services!');
        
        // Fix navigation click handlers
        document.querySelectorAll('.nav-item')[0].onclick = goHome;
        document.querySelectorAll('.nav-item')[1].onclick = () => navigateTo('services');
        document.querySelectorAll('.nav-item')[2].onclick = () => navigateTo('products');
        document.querySelectorAll('.nav-item')[3].onclick = showProfile;
    });
  </script>
</body>
</html>
